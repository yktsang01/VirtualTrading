<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Buy</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="../css/style.css">
    <script src="../js/member_script.js"></script>
    <script>
        function calculateCost() {
            var form = document.getElementById("buyForm");
            form.method = "post";
            form.action = "/member/buy";
            form.submit();
        }
        function confirmBuy() {
            var estCost = document.getElementById("estimatedCost");
            if (estCost.innerText.trim() == "0.0000") {
                var result = confirm("Are you sure to buy without knowing the cost?");
                if (result) {
                    var form = document.getElementById("buyForm");
                    form.method = "post";
                    form.action = "/member/buy";
                    form.submit();
                }
            } else {
                var form = document.getElementById("buyForm");
                form.method = "post";
                form.action = "/member/buy";
                form.submit();
            }
        }
    </script>
</head>
<body>
<div class="navbar">
    <div w3-include-html="memberTopNav.html"></div>
    <div class="dropdown">
        <button class="dropbtn" onclick="dropMember()">${email}
            <i class="fa fa-caret-down"></i>
        </button>
        <div class="dropdown-content" id="memberDropdown">
            <div w3-include-html="memberDropdownNav.html"></div>
        </div>
    </div>
</div>
<h1>Buy</h1>
<script>includeHTML();</script>
<#if invalidStock >
<p>Invalid stock. Go back to <a href="/member/dashboard">dashboard</a> to search again.
<p>
    <#elseif missingBalance >
<p>No appropriate account balance. Go to <a href="/member/accountBalance">account balance</a> to deposit funds.
<p>
    <#else>
<p>You have ${balance.currency()} ${balance.nonTradingAmount()?string(",##0.0000")} available.</p>
<#if errorMessage?? >
<p><b>Errors</b></p>
<p style="color:red;">${errorMessage}
<p>
</#if>
<form id="buyForm">
    <table>
        <tr>
            <td>Symbol</td>
            <td>${stock.symbol()}</td>
        </tr>
        <tr>
            <td>Name</td>
            <td>${stock.name()}</td>
        </tr>
        <tr>
            <td>Date</td>
            <td>${today?date}</td>
        </tr>
        <tr>
            <td>Deed</td>
            <td>BUY</td>
        </tr>
        <tr>
            <td><label for="quantity">Quantity</label></td>
            <td><input type="text" name="quantity" id="quantity"
                <#if inputtedQuantity?? > value="${inputtedQuantity}"
            </#if> ></td>
        </tr>
        <tr>
            <td>Currency</td>
            <td>${stock.currency()}</td>
        </tr>
        <tr>
        <tr>
            <td>Price</td>
            <td>${stock.price()?string(",##0.0000")}</td>
        </tr>
        <tr>
            <td>Estimated Cost</td>
            <td>
                <span id="estimatedCost"><#if estimatedCost?? > ${estimatedCost?string(",##0.0000")} <#else> 0.0000 </#if></span>
                <input type="submit" name="action" value="Calculate Cost" onclick="calculateCost()">
            </td>
        </tr>
        <tr>
            <td>&nbsp;</td>
            <td>
                <input type="hidden" name="symbol" value="${stock.symbol()}">
                <input type="hidden" name="name" value="${stock.name()}">
                <input type="hidden" name="currency" value="${stock.currency()}">
                <input type="hidden" name="transPrice" value="${stock.price()}">
                <input type="hidden" name="action" value="Buy">
                <button type="button" onclick="confirmBuy()">Buy</button>
                <button type="button" onclick="window.location='/member/dashboard';">Cancel</button>
            </td>
        </tr>
    </table>
</form>
</#if>
</body>
</html>
